## 网络通信交换的数据包结构

header以太网标头|（header ip标头|（header tcp标头|data))

发送数据包需要知道：

1. 对方的ip地址

2. 对方的mac地址

如果是同一个网络，则通过arp协议广播发送。如果不是同一个网络，通过网关，网关通过路由协议进行发送。

## 上网设置

1. 本地ip地址
2. 子网掩码
3. 网关ip
4. dnsip地址

### 静态ip

1 2 3 4 设置死，每个计算机使用的是固定的ip

### 动态ip

使用dhcp协议，动态分配ip。内网中有一台机器负责管理所有的ip，叫dhcp服务器。计算机加入网络，需要发送dhcp数据包。新加入的机器不知道ip和mac

#### dhcp协议

| head             | head         | head          | data       |
| ---------------- | ------------ | ------------- | ---------- |
| 以太网数据包标头 | ip数据包标头 | udp数据包标头 | dhcp数据包 |

1以太网标头（14字节）：包含发出方的mac地址，接收方的mac地址（dhcp服务器）。因为不知道接收方地址，故写的是FF-FF-FF-FF-FF(广播地址)

2ip数据包标头。发出和接收都不知道。所以发出写的是0.0.0.0 接收写的255.255.255.255

3udp标头。设置发出和接收端口。dhcp规定：发出是67端口 接收是68端口

广播发送，解析以太网head头，然后解析ip数据包头，之后dhcp服务器可以接收255.255.255.255,其它机器则丢弃广播信息。dhcp 响应dhcp数据包：以太网（发出mac 接收mac）,ip包（发出ip，接收ip 255...）,upd(发出67 接收68)，dhcp数据包（包含 ip 子网掩码 网关 dns）

## 请求一个地址的完成流程

1设置本地计算的 1 2 3 4

2根据域名请求域名服务器，发送dns数据包（接收端口是53）

head 以太|（head ip|（head udp|dns数据包））

dns返回域名的ip地址

3通过子网掩码，判断 当前主机ip 和 目标ip是否是同一个网络

判断方式：子网掩码 & 当前主机ip == 子网掩码 & 目标主机ip 

相等则是同一个子网，不等，则不是同一个网络

不是同一个网络，通过网关进行路由，所以目标mac地址就是网关mac地址

4浏览器通过http协议进行通信（应用层）

head 以太|head ip|head tcp| data http数据包

tcp协议 对方的端口（默认80） 自己的端口 嵌入 ip

ip需要知道 对方的 ip地址 自己的ip地址 然后嵌入 以太

以太网协议 需要对方 mac（网关 通过arp获得），自己的mac



因为以太网数据包的最长为 1500 字节，所以超过这个 需要拆分。

接收方收方 数据后 需要合并。然后再使用tcp协议进行响应



